<!DOCTYPE html>
<html lang="ar">
<head>
  <meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ù…ØªØªØ¨Ø¹ Ø§Ù„Ø³ÙˆÙ‚ Ø§Ù„Ù„Ø­Ø¸ÙŠ â€” ØªØ­Ù„ÙŠÙ„Ø§Øª Gate.io</title>
  <style>
    body{background:#111;color:#fff; font-family:Arial;padding:20px;}
    h1{color:#f44336;text-align:center;}
    .controls{margin-bottom:20px;text-align:center;}
    select,input,button{padding:8px 15px;margin:5px;border:none;border-radius:5px;background:#222;color:#fff;}
    table{width:100%;border-collapse:collapse;margin-top:10px;}
    th,td{padding:6px;border:1px solid #333;text-align:center;font-size:0.9em;}
    th{background:#222;}
    .up{color:#4caf50;} .down{color:#f44336;} .extreme{color:#ffeb3b;font-weight:bold;}
  </style>
</head>
<body>
  <h1>ğŸ“Š Ù…ØªØªØ¨Ø¹ Ø§Ù„Ø³ÙˆÙ‚ Ø§Ù„Ù„Ø­Ø¸ÙŠ â€” ØªØ­Ù„ÙŠÙ„Ø§Øª Gate.io</h1>
  <div class="controls">
    <label>Ø¹ØªØ¨Ø© %:</label>
    <select id="threshold"><option>1</option><option>5</option><option>10</option><option selected>20</option><option>50</option></select>
    <input id="search" placeholder="Ø§Ø¨Ø­Ø« Ø¹Ù† Ø¹Ù…Ù„Ø©...">
    <button onclick="setFilter('all')">Ø§Ù„ÙƒÙ„</button>
    <button onclick="setFilter('up')">ØµØ¹ÙˆØ¯ ÙÙ‚Ø·</button>
    <button onclick="setFilter('down')">Ù‡Ø¨ÙˆØ· ÙÙ‚Ø·</button>
    <button onclick="fetchData()">ğŸ”„ ØªØ­Ø¯ÙŠØ«</button>
  </div>
  <div id="tracker">Ø¬Ø§Ø± Ø§Ù„ØªØ­Ù…ÙŠÙ„...</div>

  <script>
    let coins=[], analytics={}, filter='all';

    async function fetchData(){
      coins=[];
      for(let p=1;p<=2;p++){
        const d=await fetch(`https://api.coingecko.com/api/v3/coins/markets?vs_currency=usd&per_page=200&page=${p}&price_change_percentage=24h`);
        coins=coins.concat(await d.json());
      }
      await fetchGate(); renderTable();
    }

    async function fetchGate(){
      analytics={};
      try{
        const tks=await (await fetch('https://fx-api.gateio.ws/api/v4/futures/usdt/tickers')).json();
        tks.forEach(f=>{
          const sym=f.contract.split('_')[0].toLowerCase();
          analytics[sym]={funding:parseFloat(f.funding_rate_indicative).toFixed(5)};
        });
        for(let i=0;i<20;i++){
          const sym=coins[i].symbol.toUpperCase();
          const cs=await (await fetch(`https://fx-api.gateio.ws/api/v4/futures/usdt/contract_stats?contract=${sym}_USDT`)).json();
          if(!analytics[sym.toLowerCase()]) analytics[sym.toLowerCase()]={};
          analytics[sym.toLowerCase()].open_interest = parseFloat(cs.open_interest).toFixed(0);
          analytics[sym.toLowerCase()].long_short_ratio = cs.long_short_ratio ? (cs.long_short_ratio*100).toFixed(1)+'%' : 'â€”';
          const l=await (await fetch(`https://api.gate.io/api/v4/futures/usdt/${sym}/liquidation_records`)).json();
          analytics[sym.toLowerCase()].liq = l.slice(0,5).reduce((s,x)=>s+parseFloat(x.amount),0).toFixed(0);
        }
      } catch{}
    }

    function renderTable(){
      const thr=parseFloat(document.getElementById('threshold').value);
      const sr=document.getElementById('search').value.toLowerCase();
      let f=coins.filter(c=>{
        const ch=c.price_change_percentage_24h;
        return ch && ((filter=='up'?ch>=thr:filter=='down'?ch<=-thr:Math.abs(ch)>=thr)) &&
               (c.name.toLowerCase().includes(sr)||c.symbol.toLowerCase().includes(sr));
      });
      let html=`<p>Ø¢Ø®Ø±: ${new Date().toLocaleString('ar')}</p><table><tr>
        <th>#</th><th>Ø±Ù…Ø²</th><th>Ø§Ù„Ø³Ø¹Ø±</th><th>%24</th><th>ØªÙ…ÙˆÙŠÙ„</th><th>Open Interest</th><th>L/S%</th><th>Ø§Ù„ØªØµÙÙŠØ§Øª</th></tr>`;
      f.forEach((c,i)=>{
        const s=c.symbol.toLowerCase(), a=analytics[s]||{};
        const cls=c.price_change_percentage_24h>=0?'up':'down';
        html+=`<tr>
          <td>${i+1}</td><td>${c.symbol}</td>
          <td>${c.current_price.toFixed(4)}</td>
          <td class="${cls}">${c.price_change_percentage_24h.toFixed(1)}%</td>
          <td>${a.funding||'â€”'}</td>
          <td>${a.open_interest||'â€”'}</td>
          <td>${a.long_short_ratio||'â€”'}</td>
          <td>${a.liq||'â€”'}</td>
        </tr>`;
      });
      html+='</table>';
      document.getElementById('tracker').innerHTML=html;
    }

    window.setFilter = function(t){filter=t; renderTable();}
    document.getElementById('search').addEventListener('input',renderTable);
    document.getElementById('threshold').addEventListener('change',renderTable);

    fetchData(); setInterval(fetchData,60000);
  </script>
</body>
</html>
